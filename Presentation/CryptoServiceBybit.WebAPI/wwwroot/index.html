<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>CryptoService Bybit</title>
    <style>
        td {
            padding: 15px;
        }
    </style>
</head>
<body>
    <h2>CryptoService Bybit</h2>
    <p>
        <label>Symbol:</label>
        <select id="listSymbolsSelect" name="symbols"></select>

        <label>Timeframe:</label>
        <select id="listTimeframesSelect" name="timeframes">
            <option value="1">1</option>
            <option value="3">3</option>
            <option value="5">5</option>
            <option value="15">15</option>
            <option value="30">30</option>
            <option value="60">60</option>
            <option value="120">120</option>
            <option value="240">240</option>
            <option value="360">360</option>
            <option value="720">720</option>
            <option value="D">D</option>
            <option value="W">W</option>
            <option value="M">M</option>
        </select>
    </p>
    <p>
        <label>Category</label>
        <select id="listCategoriesSelect" name="category">
            <option value="spot">Spot</option>
            <option value="inverse">Inverse</option>
        </select>
    </p>
    <p>
        <label>Info about </label>
        <label id="selectedSymbolLbl"></label>
    </p>
    <p>
        <table id="tablePrices">
            <caption><b>Prices</b></caption>
            <thead>
                <tr>
                    <td>Open</td>
                    <td>High</td>
                    <td>Low</td>
                    <td>Close</td>
                </tr>
            </thead>
            <tbody id="tablePricesBody">
            </tbody>
        </table>
    </p>
    <script>
        async function init() {
            await getTickers("spot", true);
            selectSymbol();
        }

        async function getTickers(categoryStr) {
            const response = await fetch(`/api/tickers/${categoryStr}`, {
                method: "GET",
                headers: { "Accept": "application/json" }
            });
            if (response.ok === true) {
                const responseJson = await response.json();
                const listTickers = responseJson.result.list;

                const listSymbolsElement = document.getElementById("listSymbolsSelect");
                for (let i = 0; i < listTickers.length; ++i) {
                    const optionElement = document.createElement("option");
                    const symbol = listTickers[i].symbol;
                    optionElement.value = symbol;
                    optionElement.text = symbol;
                    listSymbolsElement.append(optionElement);
                }
            }
        }

        async function getOhlcBySelectedSymbol() {
            
        }

        function selectSymbol() {
            const symbolsListElement = document.getElementById("listSymbolsSelect");
            const selectedSymbolInList = symbolsListElement.options[symbolsListElement.selectedIndex];
            const selectedSymbolLbl = document.getElementById("selectedSymbolLbl");
            selectedSymbolLbl.value = selectedSymbolInList.value;
            selectedSymbolLbl.textContent = selectedSymbolInList.value;
        }



        const symbolsListElement = document.getElementById("listSymbolsSelect");
        symbolsListElement.addEventListener("change", selectSymbol);

        init();
    </script>
</body>
</html>